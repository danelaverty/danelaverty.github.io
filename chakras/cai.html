// Add the attribute grid functionality
            function setupAttributeGrid() {
                const attributeBoxes = document.querySelectorAll('.attribute-box');
                
                // Set up drag events for all attribute boxes
                attributeBoxes.forEach(box => {
                    // When a draggable element enters the box
                    box.addEventListener('dragenter', function(e) {
                        e.preventDefault();
                        box.classList.add('highlight');
                    });
                    
                    // When a draggable element leaves the box
                    box.addEventListener('dragleave', function(e) {
                        e.preventDefault();
                        box.classList.remove('highlight');
                    });
                    
                    // Required to allow dropping
                    box.addEventListener('dragover', function(e) {
                        e.preventDefault();
                    });
                    
                    // When a draggable element is dropped
                    box.addEventListener('drop', function(e) {
                        e.preventDefault();
                        box.classList.remove('highlight');
                        
                        // Get the dragged square ID
                        const draggedId = e.dataTransfer.getData('text/plain');
                        if (!draggedId) return;
                        
                        const square = document.querySelector(`.square[data-id="${draggedId}"]`);
                        if (!square) return;
                        
                        // Get the attribute from the box
                        const attribute = box.dataset.attribute;
                        
                        // Update the square's attribute and appearance
                        applyAttributeToSquare(square, attribute);
                        
                        // Update the data
                        updateSquareData(draggedId, {
                            attribute: attribute,
                            color: attributeInfo[attribute].color
                        });
                    });
                });
            }
            
            // Apply an attribute to a square element
            function applyAttributeToSquare(square, attribute) {
                // Clear any existing content
                const existingContent = square.querySelector('.square-content');
                if (existingContent) {
                    square.removeChild(existingContent);
                }
                
                // Add the emoji content
                const squareContent = document.createElement('div');
                squareContent.className = 'square-content';
                squareContent.textContent = attributeInfo[attribute].emoji;
                square.appendChild(squareContent);
                
                // Update the background color
                square.style.backgroundColor = attributeInfo[attribute].color;
            }
            
            // Make a square draggable
            function makeSquareDraggable(square) {
                square.setAttribute('draggable', true);
                
                square.addEventListener('dragstart', function(e) {
                    e.dataTransfer.setData('text/plain', square.dataset.id);
                    e.dataTransfer.effectAllowed = 'move';
                });
                
                square.addEventListener('dragend', function(e) {
                    // Remove highlight from all attribute boxes
                    document.querySelectorAll('.attribute-box').forEach(box => {
                        box.classList.remove('highlight');
                    });
                });
            }<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chakra Visualizer</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            overflow: hidden;
            height: 100vh;
            display: flex;
        }
        
        .add-btn {
            position: absolute;
            top: 20px;
            width: 40px;
            height: 40px;
            background-color: #555;
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 24px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            z-index: 100;
        }
        
        .add-btn:hover {
            background-color: #777;
        }
        
        #add-circle-btn {
            left: 20px;
        }
        
        #add-square-btn {
            right: 20px;
            display: none; /* Initially hidden until a circle is selected */
        }

        #left-panel {
            width: 50%;
            height: 100%;
            background-color: black;
            position: relative;
            user-select: none;
        }

        #right-panel {
            width: 50%;
            height: 100%;
            background-color: #333;
            position: relative;
            user-select: none;
            transition: background-color 0.3s ease;
            display: flex;
            flex-direction: column;
        }
        
        /* Attribute grid styles */
        #attribute-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            height: 50%;
            width: 100%;
            gap: 10px;
            padding: 10px;
            box-sizing: border-box;
        }
        
        .attribute-box {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: bold;
            border-radius: 5px;
            cursor: default;
            transition: all 0.2s ease;
            text-shadow: 0 0 3px rgba(0, 0, 0, 0.5);
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.3);
        }
        
        .attribute-box.highlight {
            box-shadow: 0 0 15px white;
        }
        
        .attribute-box .emoji {
            font-size: 36px;
            margin-bottom: 10px;
        }
        
        #tiger-box {
            background-color: #FF8C00;
        }
        
        #unicorn-box {
            background-color: #FFFFFF;
            color: #333;
            text-shadow: 0 0 3px rgba(255, 255, 255, 0.5);
        }
        
        #dragon-box {
            background-color: #FF0000;
        }
        
        #shark-box {
            background-color: #0000FF;
        }
        
        /* Square attribute styles */
        .square-content {
            font-size: 24px;
            position: absolute;
            pointer-events: none;
        }

        #divider {
            width: 2px;
            height: 100%;
            background-color: #aaa;
            position: absolute;
            left: 50%;
            z-index: 1000;
        }

        .circle, .square {
            position: absolute;
            cursor: move;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
            transition: box-shadow 0.2s ease;
            transform: translate(-50%, -50%);
        }
        
        .circle {
            border-radius: 50%;
        }
        
        .circle.selected, .square.selected {
            box-shadow: 0 0 12px 4px white;
            z-index: 15;
        }

        .item-name {
            position: absolute;
            bottom: -25px;
            white-space: nowrap;
            cursor: text;
            color: white;
            font-size: 14px;
            background: none;
            border: none;
            text-align: center;
            outline: none;
        }

        .item-buttons {
            position: absolute;
            top: -40px;
            display: flex;
            gap: 5px;
        }

        .item-button {
            background-color: #555;
            color: white;
            border: none;
            border-radius: 3px;
            padding: 3px 6px;
            font-size: 12px;
            cursor: pointer;
        }

        .item-button:hover {
            background-color: #777;
        }

        #dialog-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        #dialog-box {
            background-color: #222;
            padding: 20px;
            border-radius: 5px;
            color: white;
            text-align: center;
        }

        #dialog-buttons {
            margin-top: 15px;
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .dialog-button {
            padding: 5px 15px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }

        #dialog-confirm {
            background-color: #f44336;
            color: white;
        }

        #dialog-cancel {
            background-color: #555;
            color: white;
        }
    </style>
</head>
<body>
    <div id="left-panel">
        <button id="add-circle-btn" class="add-btn">+</button>
    </div>
    <div id="divider"></div>
    <div id="right-panel">
        <button id="add-square-btn" class="add-btn">+</button>
        <div id="attribute-grid">
            <div id="tiger-box" class="attribute-box" data-attribute="tiger">
                <div class="emoji">üêØ</div>
                <div>Tiger</div>
            </div>
            <div id="unicorn-box" class="attribute-box" data-attribute="unicorn">
                <div class="emoji">ü¶Ñ</div>
                <div>Unicorn</div>
            </div>
            <div id="dragon-box" class="attribute-box" data-attribute="dragon">
                <div class="emoji">üêâ</div>
                <div>Dragon</div>
            </div>
            <div id="shark-box" class="attribute-box" data-attribute="shark">
                <div class="emoji">ü¶à</div>
                <div>Shark</div>
            </div>
        </div>
    </div>
    
    <div id="dialog-overlay">
        <div id="dialog-box">
            <div id="dialog-message">Are you sure you want to delete this item?</div>
            <div id="dialog-buttons">
                <button id="dialog-confirm" class="dialog-button">Delete</button>
                <button id="dialog-cancel" class="dialog-button">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        // Wait for the DOM to be fully loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Main elements
            const leftPanel = document.getElementById('left-panel');
            const rightPanel = document.getElementById('right-panel');
            const addCircleBtn = document.getElementById('add-circle-btn');
            const addSquareBtn = document.getElementById('add-square-btn');
            const dialogOverlay = document.getElementById('dialog-overlay');
            const dialogConfirm = document.getElementById('dialog-confirm');
            const dialogCancel = document.getElementById('dialog-cancel');
            
            // State variables
            let selectedCircle = null;
            let selectedSquare = null;
            let isDragging = false;
            let draggedElement = null;
            let dragOffsetX = 0;
            let dragOffsetY = 0;
            let data = {
                circles: [],
                squares: []
            };
            
            const predefinedColors = [
                '#FF0000', // Red
                '#FF7F00', // Orange
                '#FFFF00', // Yellow
                '#00FF00', // Green
                '#0000FF', // Blue
                '#4B0082', // Indigo
                '#9400D3', // Violet
                '#FF1493', // Pink
                '#00FFFF', // Cyan
                '#FFFFFF'  // White
            ];
            
            const attributeInfo = {
                tiger: { emoji: 'üêØ', color: '#FF8C00' },
                unicorn: { emoji: 'ü¶Ñ', color: '#FFFFFF' },
                dragon: { emoji: 'üêâ', color: '#FF0000' },
                shark: { emoji: 'ü¶à', color: '#0000FF' }
            };

            const sizes = {
                small: { circle: 40, square: 40 },
                medium: { circle: 60, square: 60 },
                large: { circle: 80, square: 80 }
            };

            // Load data from localStorage
            function loadData() {
                const savedData = localStorage.getItem('chakraVisualizerData');
                if (savedData) {
                    try {
                        data = JSON.parse(savedData);
                        
                        // Render saved circles
                        data.circles.forEach(circleData => {
                            createCircleElement(circleData);
                        });
                        
                        // Render saved squares (they'll be hidden initially)
                        data.squares.forEach(squareData => {
                            createSquareElement(squareData);
                        });
                        
                        // Hide all squares initially
                        const allSquares = document.querySelectorAll('.square');
                        allSquares.forEach(square => {
                            square.style.display = 'none';
                        });
                    } catch (e) {
                        console.error("Error loading saved data:", e);
                    }
                }
            }

            // Save data to localStorage
            function saveData() {
                localStorage.setItem('chakraVisualizerData', JSON.stringify(data));
            }

            // Create a circle element
            function createCircleElement(circleData) {
                const circle = document.createElement('div');
                circle.className = 'circle';
                circle.dataset.id = circleData.id;
                
                circle.style.width = `${circleData.size}px`;
                circle.style.height = `${circleData.size}px`;
                circle.style.left = `${circleData.x}px`;
                circle.style.top = `${circleData.y}px`;
                circle.style.backgroundColor = circleData.color;
                
                // Create name input
                const nameInput = document.createElement('input');
                nameInput.type = 'text';
                nameInput.className = 'item-name';
                nameInput.value = circleData.name;
                nameInput.addEventListener('blur', function() {
                    updateCircleData(circleData.id, { name: this.value });
                });
                nameInput.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        this.blur();
                    }
                });
                nameInput.addEventListener('click', function(e) {
                    e.stopPropagation();
                });

                // Create buttons container (initially hidden)
                const buttonsContainer = document.createElement('div');
                buttonsContainer.className = 'item-buttons';
                buttonsContainer.style.display = 'none';
                
                // Random color button
                const colorButton = document.createElement('button');
                colorButton.className = 'item-button';
                colorButton.textContent = 'Color';
                colorButton.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const randomColor = predefinedColors[Math.floor(Math.random() * predefinedColors.length)];
                    circle.style.backgroundColor = randomColor;
                    updateCircleData(circleData.id, { color: randomColor });
                });
                
                // Size button
                const sizeButton = document.createElement('button');
                sizeButton.className = 'item-button';
                sizeButton.textContent = 'Size';
                sizeButton.addEventListener('click', function(e) {
                    e.stopPropagation();
                    
                    let currentSize = parseInt(circle.style.width, 10);
                    let newSize;
                    
                    if (currentSize === sizes.small.circle) {
                        newSize = sizes.medium.circle;
                    } else if (currentSize === sizes.medium.circle) {
                        newSize = sizes.large.circle;
                    } else {
                        newSize = sizes.small.circle;
                    }
                    
                    circle.style.width = `${newSize}px`;
                    circle.style.height = `${newSize}px`;
                    updateCircleData(circleData.id, { size: newSize });
                });
                
                // Delete button
                const deleteButton = document.createElement('button');
                deleteButton.className = 'item-button';
                deleteButton.textContent = 'Delete';
                deleteButton.addEventListener('click', function(e) {
                    e.stopPropagation();
                    showDeleteDialog(function() {
                        leftPanel.removeChild(circle);
                        deleteCircleData(circleData.id);
                        
                        if (selectedCircle === circle) {
                            deselectCircle();
                        }
                    });
                });
                
                // Add buttons to container
                buttonsContainer.appendChild(colorButton);
                buttonsContainer.appendChild(sizeButton);
                buttonsContainer.appendChild(deleteButton);
                
                // Add elements to circle
                circle.appendChild(buttonsContainer);
                circle.appendChild(nameInput);
                
                // Click handler for selection
                circle.addEventListener('click', function(e) {
                    e.stopPropagation();
                    selectItem(circle);
                });
                
                // Add drag functionality
                addDragFunctionality(circle, function(x, y) {
                    updateCircleData(circleData.id, { x, y });
                });
                
                leftPanel.appendChild(circle);
                return circle;
            }

            // Create a square element
            function createSquareElement(squareData) {
                const square = document.createElement('div');
                square.className = 'square';
                square.dataset.id = squareData.id;
                square.dataset.circleId = squareData.circleId;
                
                square.style.width = `${squareData.size}px`;
                square.style.height = `${squareData.size}px`;
                square.style.left = `${squareData.x}px`;
                square.style.top = `${squareData.y}px`;
                square.style.backgroundColor = squareData.color;
                
                // Add attribute emoji if it exists
                if (squareData.attribute) {
                    const squareContent = document.createElement('div');
                    squareContent.className = 'square-content';
                    squareContent.textContent = attributeInfo[squareData.attribute].emoji;
                    square.appendChild(squareContent);
                }
                
                // Create name input
                const nameInput = document.createElement('input');
                nameInput.type = 'text';
                nameInput.className = 'item-name';
                nameInput.value = squareData.name;
                nameInput.addEventListener('blur', function() {
                    updateSquareData(squareData.id, { name: this.value });
                });
                nameInput.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        this.blur();
                    }
                });
                nameInput.addEventListener('click', function(e) {
                    e.stopPropagation();
                });

                // Create buttons container (initially hidden)
                const buttonsContainer = document.createElement('div');
                buttonsContainer.className = 'item-buttons';
                buttonsContainer.style.display = 'none';
                
                // Random color button
                const colorButton = document.createElement('button');
                colorButton.className = 'item-button';
                colorButton.textContent = 'Color';
                colorButton.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const randomColor = predefinedColors[Math.floor(Math.random() * predefinedColors.length)];
                    square.style.backgroundColor = randomColor;
                    updateSquareData(squareData.id, { color: randomColor });
                });
                
                // Size button
                const sizeButton = document.createElement('button');
                sizeButton.className = 'item-button';
                sizeButton.textContent = 'Size';
                sizeButton.addEventListener('click', function(e) {
                    e.stopPropagation();
                    
                    let currentSize = parseInt(square.style.width, 10);
                    let newSize;
                    
                    if (currentSize === sizes.small.square) {
                        newSize = sizes.medium.square;
                    } else if (currentSize === sizes.medium.square) {
                        newSize = sizes.large.square;
                    } else {
                        newSize = sizes.small.square;
                    }
                    
                    square.style.width = `${newSize}px`;
                    square.style.height = `${newSize}px`;
                    updateSquareData(squareData.id, { size: newSize });
                });
                
                // Delete button
                const deleteButton = document.createElement('button');
                deleteButton.className = 'item-button';
                deleteButton.textContent = 'Delete';
                deleteButton.addEventListener('click', function(e) {
                    e.stopPropagation();
                    showDeleteDialog(function() {
                        rightPanel.removeChild(square);
                        deleteSquareData(squareData.id);
                        
                        if (selectedSquare === square) {
                            deselectSquare();
                        }
                    });
                });
                
                // Add buttons to container
                buttonsContainer.appendChild(colorButton);
                buttonsContainer.appendChild(sizeButton);
                buttonsContainer.appendChild(deleteButton);
                
                // Add elements to square
                square.appendChild(buttonsContainer);
                square.appendChild(nameInput);
                
                // Click handler for selection
                square.addEventListener('click', function(e) {
                    e.stopPropagation();
                    selectItem(square);
                });
                
                // Make the square draggable for attribute assignment
                makeSquareDraggable(square);
                
                // Add drag functionality
                addDragFunctionality(square, function(x, y) {
                    updateSquareData(squareData.id, { x, y });
                });
                
                rightPanel.appendChild(square);
                return square;
            }

            // Add drag functionality to an element
            function addDragFunctionality(element, updateCallback) {
                let startDrag = function(e) {
                    // Only start dragging if it's not a drag-and-drop operation
                    if (e.target === element && !e.dataTransfer) {
                        isDragging = true;
                        draggedElement = element;
                        element.style.zIndex = 20;
                    }
                };
                
                element.addEventListener('mousedown', startDrag);
                
                // Store the event handlers on the element so they can be removed if needed
                element._dragHandlers = {
                    startDrag: startDrag
                };
            }

            // Select an item (circle or square)
            function selectItem(item) {
                if (item.classList.contains('circle')) {
                    // Deselect previously selected circle if any
                    if (selectedCircle && selectedCircle !== item) {
                        const prevButtons = selectedCircle.querySelector('.item-buttons');
                        if (prevButtons) {
                            prevButtons.style.display = 'none';
                        }
                        selectedCircle.classList.remove('selected');
                    }
                    
                    selectedCircle = item;
                    const circleId = item.dataset.id;
                    
                    // Show buttons for the selected circle
                    const buttons = item.querySelector('.item-buttons');
                    if (buttons) {
                        buttons.style.display = 'flex';
                    }
                    
                    // Add selected class for visual indication
                    item.classList.add('selected');
                    
                    // Activate right panel
                    rightPanel.style.backgroundColor = 'black';
                    rightPanel.classList.add('active');
                    // Show the add square button
                    addSquareBtn.style.display = 'flex';
                    
                    // Show only squares associated with this circle
                    showSquaresForCircle(circleId);
                } else if (item.classList.contains('square')) {
                    // Deselect previously selected square if any
                    if (selectedSquare && selectedSquare !== item) {
                        const prevButtons = selectedSquare.querySelector('.item-buttons');
                        if (prevButtons) {
                            prevButtons.style.display = 'none';
                        }
                        selectedSquare.classList.remove('selected');
                    }
                    
                    selectedSquare = item;
                    
                    // Show buttons for the selected square
                    const buttons = item.querySelector('.item-buttons');
                    if (buttons) {
                        buttons.style.display = 'flex';
                    }
                    
                    // Add selected class for visual indication
                    item.classList.add('selected');
                }
            }
            
            // Show only squares associated with the selected circle
            function showSquaresForCircle(circleId) {
                // Hide all squares first
                const allSquares = document.querySelectorAll('.square');
                allSquares.forEach(square => {
                    square.style.display = 'none';
                });
                
                // Show only squares associated with this circle
                const relatedSquares = document.querySelectorAll(`.square[data-circle-id="${circleId}"]`);
                relatedSquares.forEach(square => {
                    square.style.display = 'flex';
                });
                
                // Deselect square if it's not visible
                if (selectedSquare && selectedSquare.dataset.circleId !== circleId) {
                    deselectSquare();
                }
            }

            // Deselect items
            function deselectCircle() {
                if (selectedCircle) {
                    const buttons = selectedCircle.querySelector('.item-buttons');
                    if (buttons) {
                        buttons.style.display = 'none';
                    }
                    
                    // Remove selected class
                    selectedCircle.classList.remove('selected');
                    
                    selectedCircle = null;
                    
                    // Deactivate right panel
                    rightPanel.style.backgroundColor = '#333';
                    rightPanel.classList.remove('active');
                    // Hide the add square button
                    addSquareBtn.style.display = 'none';
                    
                    // Hide all squares
                    const allSquares = document.querySelectorAll('.square');
                    allSquares.forEach(square => {
                        square.style.display = 'none';
                    });
                    
                    // Also deselect square since right panel is deactivated
                    deselectSquare();
                }
            }
            
            function deselectSquare() {
                if (selectedSquare) {
                    const buttons = selectedSquare.querySelector('.item-buttons');
                    if (buttons) {
                        buttons.style.display = 'none';
                    }
                    
                    // Remove selected class
                    selectedSquare.classList.remove('selected');
                    
                    selectedSquare = null;
                }
            }
            
            function deselectAll() {
                deselectCircle();
                deselectSquare();
            }

            // Show delete confirmation dialog
            function showDeleteDialog(onConfirm) {
                dialogOverlay.style.display = 'flex';
                
                const confirmHandler = function() {
                    onConfirm();
                    dialogOverlay.style.display = 'none';
                    dialogConfirm.removeEventListener('click', confirmHandler);
                    dialogCancel.removeEventListener('click', cancelHandler);
                };
                
                const cancelHandler = function() {
                    dialogOverlay.style.display = 'none';
                    dialogConfirm.removeEventListener('click', confirmHandler);
                    dialogCancel.removeEventListener('click', cancelHandler);
                };
                
                dialogConfirm.addEventListener('click', confirmHandler);
                dialogCancel.addEventListener('click', cancelHandler);
            }

            // Data management functions
            function generateId() {
                return Date.now().toString(36) + Math.random().toString(36).substring(2);
            }

            function addCircleData(circleData) {
                data.circles.push(circleData);
                saveData();
            }

            function updateCircleData(id, updates) {
                const index = data.circles.findIndex(circle => circle.id === id);
                if (index !== -1) {
                    data.circles[index] = { ...data.circles[index], ...updates };
                    saveData();
                }
            }

            function deleteCircleData(id) {
                data.circles = data.circles.filter(circle => circle.id !== id);
                saveData();
            }

            function addSquareData(squareData) {
                data.squares.push(squareData);
                saveData();
            }

            function updateSquareData(id, updates) {
                const index = data.squares.findIndex(square => square.id === id);
                if (index !== -1) {
                    data.squares[index] = { ...data.squares[index], ...updates };
                    saveData();
                }
            }

            function deleteSquareData(id) {
                data.squares = data.squares.filter(square => square.id !== id);
                saveData();
            }

            // Add circle button click handler (this is the key function we're fixing)
            addCircleBtn.addEventListener('click', function(e) {
                console.log("Add circle button clicked");
                e.stopPropagation();
                
                // Deselect current item
                deselectCircle();
                
                // Create a new circle at a random position near the center
                const id = generateId();
                const panelRect = leftPanel.getBoundingClientRect();
                const centerX = panelRect.width / 2;
                const centerY = panelRect.height / 2;
                
                // Random position within ¬±100px of center
                const randomOffset = () => Math.random() * 200 - 100;
                const x = Math.max(50, Math.min(panelRect.width - 100, centerX + randomOffset()));
                const y = Math.max(50, Math.min(panelRect.height - 100, centerY + randomOffset()));
                
                const circleData = {
                    id: id,
                    x: x,
                    y: y,
                    size: sizes.medium.circle,
                    color: predefinedColors[0],
                    name: '<n>'
                };
                
                // Create and add circle to DOM
                const circle = createCircleElement(circleData);
                
                // Add to data and save
                addCircleData(circleData);
                
                // Select the new circle
                selectItem(circle);
            });

            // Left panel click - only deselect circle
            leftPanel.addEventListener('click', function(e) {
                // Only handle clicks directly on the panel (not on children)
                if (e.target === leftPanel) {
                    deselectCircle();
                }
            });

            // Right panel click handler - only for deselection of squares
            rightPanel.addEventListener('click', function(e) {
                // Only handle clicks directly on the panel (not on children)
                if (e.target === rightPanel) {
                    // Only deselect squares, never deselect circles
                    deselectSquare();
                }
            });
            
            // Add square button click handler
            addSquareBtn.addEventListener('click', function(e) {
                console.log("Add square button clicked");
                e.stopPropagation();
                
                // Create a new square at a random position near the center
                const id = generateId();
                const panelRect = rightPanel.getBoundingClientRect();
                const centerX = panelRect.width / 2;
                const centerY = panelRect.height / 2;
                
                // Random position within ¬±100px of center
                const randomOffset = () => Math.random() * 200 - 100;
                const x = Math.max(50, Math.min(panelRect.width - 100, centerX + randomOffset()));
                const y = Math.max(50, Math.min(panelRect.height - 100, centerY + randomOffset()));
                
                const squareData = {
                    id: id,
                    circleId: selectedCircle.dataset.id, // Associate with the selected circle
                    x: x,
                    y: y,
                    size: sizes.medium.square,
                    color: predefinedColors[0],
                    name: '<n>'
                };
                
                // Create and add square to DOM
                const square = createSquareElement(squareData);
                
                // Add to data and save
                addSquareData(squareData);
                
                // Make the square draggable for attribute assignment
                makeSquareDraggable(square);
                
                // Select the new square
                selectItem(square);
            });

            // Global mouse event handlers
            document.addEventListener('mousemove', function(e) {
                if (isDragging && draggedElement) {
                    e.preventDefault();
                    
                    const parentRect = draggedElement.parentElement.getBoundingClientRect();
                    
                    // Calculate position considering the transform: translate(-50%, -50%)
                    const x = e.clientX - parentRect.left;
                    const y = e.clientY - parentRect.top;
                    
                    // Ensure the element stays within bounds
                    const boundedX = Math.max(0, Math.min(x, parentRect.width));
                    const boundedY = Math.max(0, Math.min(y, parentRect.height));
                    
                    draggedElement.style.left = `${boundedX}px`;
                    draggedElement.style.top = `${boundedY}px`;
                    
                    // Call the appropriate update function based on the type of element
                    if (draggedElement.classList.contains('circle')) {
                        updateCircleData(draggedElement.dataset.id, { x: boundedX, y: boundedY });
                    } else if (draggedElement.classList.contains('square')) {
                        updateSquareData(draggedElement.dataset.id, { x: boundedX, y: boundedY });
                    }
                }
            });
            
            document.addEventListener('mouseup', function() {
                if (isDragging && draggedElement) {
                    isDragging = false;
                    draggedElement.style.zIndex = draggedElement.classList.contains('selected') ? 15 : 10;
                    draggedElement = null;
                }
            });
            
            document.addEventListener('mouseleave', function() {
                if (isDragging && draggedElement) {
                    isDragging = false;
                    draggedElement.style.zIndex = draggedElement.classList.contains('selected') ? 15 : 10;
                    draggedElement = null;
                }
            });

            // Add console log to confirm initialization
            console.log("Chakra Visualizer initialized successfully");
            
            // Load saved data on page load
            loadData();
            
            // Set up the attribute grid
            setupAttributeGrid();
        });
    </script>
</body>
</html>
